«Пользователи социальных сетей часто публикуют сообщения о том, где и как они проводят время (например, фотографии или тексты с геолокацией и подписью). Идея проекта заключается в том, чтобы построить интерактивную карту СПб: где и что делают люди в городе, выявить какие-то закономерности (например, посещение кинотеатра предшествует ужину), посмотреть на загруженность тех или иных районов СПб в разные временные промежутки».
Мы выбрали самую, на наш взгляд, популярную соцсеть, где публикуются фото с геолокацией, – Инстаграм. Для анализа данных о перемещении пользователя, например, из кинотеатра в ресторан требовался доступ разработчика – уникальный ключ access-token, который мы получили, но политика Инстаграма позволяет собирать информацию только о своём профиле, поэтому мы решили изучить популярные места в целом.

Файл «Instagram»:
1. При помощи access-токена мы получили доступ к списку локаций в радиусе 500-750 м от рассматриваемой широты и долготы (чтобы убедиться, что он работает, взяли какую-то случайную точку на карте города).
2. Взяли прямоугольник, покрывающий Петроградский район и его окрестности, сделали сетку, рассмотрели координаты каждой точки в этой сетке и записали список соседних локаций, как в п. 1, объединили в большой список, убрали повторы.
3. Решили собирать данные по хэштегам, но поняли, что идея несостоятельна ввиду огромного количества коммерческих аккаунтов с соответствующими рекламными хэштегами по типу #детскиекомбинезоныспб.
4. Вернулись к локациям: создали рекурсивную функцию, срабатывающую каждый час: по id каждой локации из п. 2 она берёт количество публикаций и итоговый список записывает в csv-файл. Данные собирались две с половиной недели.

Далее файлы проверялись вручную на предмет вообще наличия собранных данных, были исправлены ошибки, появившиеся из-за плохого интернет-соединения.

Файл «Запись»:
Все csv-файлы за каждый час объединились в большую таблицу.

Далее в Экселе считались средние значения прироста количества фотографий каждый час в одинаковые дни, потом объединили в средние по будням каждый час и по выходным каждый час. Проведена кластеризация в R, выделены вполне естественные и интуитивно понятные периоды, когда скорость инстапостинга одинаковая. Удалены «неинтересные» периоды: когда популярность всех локаций нисколько не растёт (как ни странно, это ночь). Рассчитан прирост количества публикаций от самого первого наблюдения до самого последнего в долях единицы, после чего в качестве популярных выбраны те локации, у которых доля прироста выше средней по району (около двадцати).

Файл «Для карты»:
Вновь по id были собраны широта и долгота каждой локации из тех примерно двадцати наиболее популярных, потому что id не стали постоянно таскать с самого начала (хотя надо было). Создан массив, необходимый для работы с html-кодом карты 2ГИС, потому что у Яндекса это всё косячное даже в их собственном примере. Взят пример работы с API 2ГИС, где показаны филиалы Райффайзена в Москве, но вместо них вставили наш массив и заменили логотип банка на герб Санкт-Петербурга. Отдельная ячейка запускает локальную веб-страницу.
